<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PSAboot">
<title>Impact of Data Order for Propensity Score Matching • PSAboot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Impact of Data Order for Propensity Score Matching">
<meta property="og:description" content="PSAboot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PSAboot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/PSAboot.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MatchingOrder.html">Impact of Data Order for Propensity Score Matching</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jbryer/PSAboot/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Impact of Data Order for Propensity Score Matching</h1>
                        <h4 data-toc-skip class="author">Jason Bryer,
Ph.D.</h4>
            
            <h4 data-toc-skip class="date">2023-03-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbryer/PSAboot/blob/HEAD/vignettes/MatchingOrder.Rmd" class="external-link"><code>vignettes/MatchingOrder.Rmd</code></a></small>
      <div class="d-none name"><code>MatchingOrder.Rmd</code></div>
    </div>

    
    
<p>Propensity score matching (PSM; Rosenbaum &amp; Rubin, 1983) has
become a popular approach for adjuting for selection bias in
observational studies. However, recent studies have shown that under
certain circumstances PSM may increase bias. In particular, Lunt (2014)
showed that the order in which treated units are matched, along with
caliper specifications, can impact the estimates. This paper explores
the effects of matching order using the <code>PSAboot</code> package for
bootstrapping propensity score analysis using two of the more popular R
packages for matching, <code>MatchIt</code> (Ho, Imai, King, &amp;
Stuart, 2011) and <code>Matching</code> (Sekhon, 2011).</p>
<p>Set the number of bootstrap samples. This should be set to at least
100 but kept small to reduce the execution time for CRAN
submissions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot.M</span> <span class="op">=</span> <span class="fl">10</span></span></code></pre></div>
<div class="section level3">
<h3 id="matching-procedures">Matching Procedures<a class="anchor" aria-label="anchor" href="#matching-procedures"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot.matchit.random</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Tr</span>, <span class="va">Y</span>, <span class="va">X</span>, <span class="va">X.trans</span>, <span class="va">formu</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/boot.matchit.html">boot.matchit</a></span><span class="op">(</span>Tr <span class="op">=</span> <span class="va">Tr</span>, Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, X.trans <span class="op">=</span> <span class="va">X.trans</span>, formu <span class="op">=</span> <span class="va">formu</span>, m.order <span class="op">=</span> <span class="st">'random'</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">boot.matching.random</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Tr</span>, <span class="va">Y</span>, <span class="va">X</span>, <span class="va">X.trans</span>, <span class="va">formu</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/boot.matching.html">boot.matching</a></span><span class="op">(</span>Tr <span class="op">=</span> <span class="va">Tr</span>, Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, X.trans <span class="op">=</span> <span class="va">X.trans</span>, formu <span class="op">=</span> <span class="va">formu</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">SimpleMatch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Tr</span>, <span class="va">Y</span>, <span class="va">X</span>, <span class="va">X.trans</span>, <span class="va">formu</span>, <span class="va">caliper</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">is.logical</a></span><span class="op">(</span><span class="va">Tr</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">Tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">Tr</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">formu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.formula.html" class="external-link">update.formula</a></span><span class="op">(</span><span class="va">formu</span>, <span class="st">'treat ~ .'</span><span class="op">)</span></span>
<span>    <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">formu</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>treat <span class="op">=</span> <span class="va">Tr</span>, <span class="va">X</span><span class="op">)</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">Tr</span><span class="op">)</span>, Treat.Y <span class="op">=</span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span><span class="op">]</span>, Treat.ps <span class="op">=</span> <span class="va">ps</span><span class="op">[</span><span class="va">Tr</span><span class="op">]</span>,</span>
<span>                          Control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, Control.Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, </span>
<span>                          Control.ps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">available.Control</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">Tr</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">Tr</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">ps</span><span class="op">[</span><span class="op">!</span><span class="va">Tr</span> <span class="op">&amp;</span> <span class="va">available.Control</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">caliper</span><span class="op">)</span></span>
<span>            <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">Tr</span> <span class="op">&amp;</span> <span class="va">available.Control</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">matches</span><span class="op">[</span><span class="va">matches</span><span class="op">$</span><span class="va">Treat</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span><span class="op">$</span><span class="va">Control</span> <span class="op">&lt;-</span> <span class="va">m</span></span>
<span>            <span class="va">matches</span><span class="op">[</span><span class="va">matches</span><span class="op">$</span><span class="va">Treat</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span><span class="op">$</span><span class="va">Control.Y</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">m</span><span class="op">]</span></span>
<span>            <span class="va">matches</span><span class="op">[</span><span class="va">matches</span><span class="op">$</span><span class="va">Treat</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span><span class="op">$</span><span class="va">Control.ps</span> <span class="op">&lt;-</span> <span class="va">ps</span><span class="op">[</span><span class="va">m</span><span class="op">]</span></span>
<span>            <span class="va">available.Control</span><span class="op">[</span><span class="va">m</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">match.t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">matches</span><span class="op">$</span><span class="va">Treat.Y</span>, <span class="va">matches</span><span class="op">$</span><span class="va">Control.Y</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        summary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">match.t</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>                  ci.min <span class="op">=</span> <span class="va">match.t</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                  ci.max <span class="op">=</span> <span class="va">match.t</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                  p <span class="op">=</span> <span class="va">match.t</span><span class="op">$</span><span class="va">p.value</span>,</span>
<span>                  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">match.t</span><span class="op">$</span><span class="va">statistic</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        details <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Matches <span class="op">=</span> <span class="va">matches</span>, t.test <span class="op">=</span> <span class="va">match.t</span><span class="op">)</span>,</span>
<span>        balance <span class="op">=</span> <span class="fu"><a href="../reference/balance.matching.html">balance.matching</a></span><span class="op">(</span><span class="va">matches</span><span class="op">$</span><span class="va">Treat</span>, <span class="va">matches</span><span class="op">$</span><span class="va">Control</span>, <span class="va">X.trans</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-1-lalonde">Example 1: Lalonde<a class="anchor" aria-label="anchor" href="#example-1-lalonde"></a>
</h3>
<p>First example will use the classic <code>lalonde</code> data
(LaLonde, 1986; Dehejia &amp; Wahba, 1999).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">'Matching'</span><span class="op">)</span></span></code></pre></div>
<p>Typically, bootstrapping draws <code>M</code> random samples with
replacement. However, by setting the <code>control.replace</code> and
<code>treated.replace</code> parameters to <code>FALSE</code> and the
bootstrap sample sizes equal to the number of observations we can
evaluate the impact of ordering.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lalonde.boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSAboot.html">PSAboot</a></span><span class="op">(</span>Tr <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                        Y <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">re78</span>,</span>
<span>                        X <span class="op">=</span> <span class="va">lalonde</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                        seed <span class="op">=</span> <span class="fl">2112</span>,</span>
<span>                        M <span class="op">=</span> <span class="va">boot.M</span>,</span>
<span>                        control.sample.size <span class="op">=</span> <span class="fl">260</span>, control.replace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        treated.sample.size <span class="op">=</span> <span class="fl">185</span>, treated.replace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/getPSAbootMethods.html">getPSAbootMethods</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Matching'</span>,<span class="st">'MatchIt'</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                    <span class="st">'MatchingRandom'</span> <span class="op">=</span> <span class="va">boot.matching.random</span>,</span>
<span>                                    <span class="st">'MatchItRandom'</span> <span class="op">=</span> <span class="va">boot.matchit.random</span>,</span>
<span>                                    <span class="st">'NearestNeighbor'</span> <span class="op">=</span> <span class="va">SimpleMatch</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 10 bootstrap samples using 5 methods.</span></span>
<span><span class="co">## Bootstrap sample sizes:</span></span>
<span><span class="co">##    Treated=185 (100%) without replacement.</span></span>
<span><span class="co">##    Control=260 (100%) without replacement.</span></span></code></pre>
<p>Boxplot of estimated effect sizes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">lalonde.boot</span><span class="op">)</span></span></code></pre></div>
<p><img src="MatchingOrder_files/figure-html/lalonde-boxplot-1.png" width="1152"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lalonde.bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance.html">balance</a></span><span class="op">(</span><span class="va">lalonde.boot</span><span class="op">)</span></span>
<span><span class="va">tmp.bal</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">lalonde.bal</span><span class="op">$</span><span class="va">pooled</span><span class="op">)</span></span>
<span><span class="va">tmp.est</span> <span class="op">&lt;-</span> <span class="va">lalonde.boot</span><span class="op">$</span><span class="va">pooled.summary</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'iter'</span>,<span class="st">'method'</span>,<span class="st">'estimate'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">tmp.bal</span>, <span class="va">tmp.est</span>, by.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Var1'</span>,<span class="st">'Var2'</span><span class="op">)</span>, by.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'iter'</span>,<span class="st">'method'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">estimate</span>, group <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Var2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Balance'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Estimate'</span><span class="op">)</span></span></code></pre></div>
<p><img src="MatchingOrder_files/figure-html/lalonde-balance-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="exmaple-2-tutoring">Exmaple 2: Tutoring<a class="anchor" aria-label="anchor" href="#exmaple-2-tutoring"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tutoring</span>, package <span class="op">=</span> <span class="st">'TriMatch'</span><span class="op">)</span></span>
<span><span class="va">tutoring</span><span class="op">$</span><span class="va">treatbool</span> <span class="op">&lt;-</span> <span class="va">tutoring</span><span class="op">$</span><span class="va">treat</span> <span class="op">!=</span> <span class="st">'Control'</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutoring.boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSAboot.html">PSAboot</a></span><span class="op">(</span>Tr <span class="op">=</span> <span class="va">tutoring</span><span class="op">$</span><span class="va">treatbool</span>, </span>
<span>                         Y <span class="op">=</span> <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span>, </span>
<span>                         X <span class="op">=</span> <span class="va">tutoring</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Gender'</span>, <span class="st">'Ethnicity'</span>, <span class="st">'Military'</span>, <span class="st">'ESL'</span>,</span>
<span>                                      <span class="st">'EdMother'</span>, <span class="st">'EdFather'</span>, <span class="st">'Age'</span>, <span class="st">'Employment'</span>,</span>
<span>                                      <span class="st">'Income'</span>, <span class="st">'Transfer'</span>, <span class="st">'GPA'</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                         seed <span class="op">=</span> <span class="fl">2112</span>,</span>
<span>                         M <span class="op">=</span> <span class="va">boot.M</span>,</span>
<span>                         control.sample.size <span class="op">=</span><span class="fl">918</span>, control.replace  <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         treated.sample.size <span class="op">=</span><span class="fl">224</span>, treated.replace  <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         methods <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/getPSAbootMethods.html">getPSAbootMethods</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Matching'</span>,<span class="st">'MatchIt'</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  <span class="st">'MatchingRandom'</span> <span class="op">=</span> <span class="va">boot.matching.random</span>,</span>
<span>                                  <span class="st">'MatchItRandom'</span> <span class="op">=</span> <span class="va">boot.matchit.random</span>,</span>
<span>                                  <span class="st">'NearestNeighbor'</span> <span class="op">=</span> <span class="va">SimpleMatch</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 10 bootstrap samples using 5 methods.</span></span>
<span><span class="co">## Bootstrap sample sizes:</span></span>
<span><span class="co">##    Treated=224 (100%) without replacement.</span></span>
<span><span class="co">##    Control=918 (100%) without replacement.</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span></code></pre></div>
<p><img src="MatchingOrder_files/figure-html/tutoring-boxplot-1.png" width="1152"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutoring.bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance.html">balance</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span>
<span><span class="va">tmp.bal</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">tutoring.bal</span><span class="op">$</span><span class="va">pooled</span><span class="op">)</span></span>
<span><span class="va">tmp.est</span> <span class="op">&lt;-</span> <span class="va">tutoring.boot</span><span class="op">$</span><span class="va">pooled.summary</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'iter'</span>,<span class="st">'method'</span>,<span class="st">'estimate'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">tmp.bal</span>, <span class="va">tmp.est</span>, by.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Var1'</span>,<span class="st">'Var2'</span><span class="op">)</span>, by.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'iter'</span>,<span class="st">'method'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">estimate</span>, group <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Var2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Balance'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Estimate'</span><span class="op">)</span></span></code></pre></div>
<p><img src="MatchingOrder_files/figure-html/tutoring-balance-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Daniel E. Ho, Kosuke Imai, Gary King, Elizabeth A. Stuart (2011).
MatchIt: Nonparametric Preprocessing for Parametric Causal Inference.
Journal of Statistical Software, Vol. 42, No. 8, pp. 1-28. URL <a href="https://www.jstatsoft.org/v42/i08/" class="external-link uri">https://www.jstatsoft.org/v42/i08/</a></p>
<p>Jasjeet S. Sekhon (2011). Multivariate and Propensity Score Matching
Software with Automated Balance Optimization: The Matching Package for
R. Journal of Statistical Software, 42(7), 1-52. URL <a href="https://www.jstatsoft.org/v42/i07/" class="external-link uri">https://www.jstatsoft.org/v42/i07/</a>.</p>
<p>Lunt, M. (2014). Selecting an appropriate caliper can be essential
for achieving good balance with propensity score matching. Practice of
Epidemiology, 179(2), 226-235.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jason Bryer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
