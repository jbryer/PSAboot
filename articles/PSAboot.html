<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PSAboot">
<title>Bootstrapping for Propensity Score Analysis • PSAboot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bootstrapping for Propensity Score Analysis">
<meta property="og:description" content="PSAboot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PSAboot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/PSAboot.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MatchingOrder.html">Impact of Data Order for Propensity Score Matching</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jbryer/PSAboot/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Bootstrapping for Propensity Score Analysis</h1>
                        <h4 data-toc-skip class="author">Jason Bryer,
Ph.D.</h4>
            
            <h4 data-toc-skip class="date">2023-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jbryer/PSAboot/blob/HEAD/vignettes/PSAboot.Rmd" class="external-link"><code>vignettes/PSAboot.Rmd</code></a></small>
      <div class="d-none name"><code>PSAboot.Rmd</code></div>
    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      As the popularity of propensity score methods for estimating
      causal effects in observational studies increase, the choices
      researchers have for which methods to use has also increased.
      Rosenbaum (2012) suggested that there are benefits for testing the
      null hypothesis more than once in observational studies. With the
      wide availability of high power computers resampling methods such
      as bootstrapping (Efron, 1979) have become popular for providing
      more stable estimates of the sampling distribution. This paper
      introduces the <code>PSAboot</code> package for R that provides
      functions for bootstrapping propensity score methods. It deviates
      from traditional bootstrapping methods by allowing for different
      sampling specifications for treatment and control groups, mainly
      to ensure the ratio of treatment-to-control observations are
      maintained. Additionally, this framework will provide estimates
      using multiple methods for each bootstrap sample. Two examples are
      discussed: the classic National Work Demonstration and PSID
      (Lalonde, 1986) study and a study on tutoring effects on student
      grades.
    </div>
    
<p>Set the number of bootstrap samples. This should be set to at least
100 but kept small to reduce the execution time for CRAN
submissions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot.M</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></code></pre></div>
<p><strong>NOTE: This vignette uses 10 bootstrap samples. It is
generally recommended to use at least 100 bootstrap samples or more for
final publication.</strong></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The latest version of the <code>PSAboot</code> package can be
downloaded from Github using the <code>devtools</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'jbryer/PSAboot'</span><span class="op">)</span></span></code></pre></div>
<p>The <code>PSAboot</code> function will perform the actual
bootstrapping. It has a number of parameters for to specify how the
bootstrap samples are drawn.</p>
<ul>
<li>
<code>Tr</code> - a numeric (0 for control and 1 for treatment) or
logical vector of treatment indicators.</li>
<li>
<code>Y</code> - a numeric vector with the outcome of interest.</li>
<li>
<code>X</code> - a data frame of covaraites.</li>
<li>
<code>M</code> (default is 100) - the number of bootstrap samples to
draw.</li>
<li>
<code>formu</code> - the formula for estimating the propensity
scores in phase I. Note that the dependent variable does not need to be
specified as it will be replaced when combining the <code>Tr</code>
vector and <code>X</code> data frame.</li>
<li>
<code>control.ratio</code> (default is 5) - This specifies the
sample size of control units as a ratio of treatment units. For example,
with a default value of 5 and 100 treatment units, this methods will
sample 500 control units for each sample, or the number of control units
if smaller than 500. When the ratio of treatment-to-control units
increases, the range of propensity scores (using logistic regression)
shrinks. Randomly selecting a subset of control units often results in
wider and better overlapping distribution of propensity scores. See the
the <a href="https://github.com/jbryer/multilevelPSA" class="external-link"><code>PSranges</code></a>
function in the <a href="https://github.com/jbryer/multilevelPSA" class="external-link"><code>multilevelPSA</code></a>
package for more information.</li>
<li>
<code>control.sample.size</code> (default is 5 times the number of
treatment units) - The number of control units to sample for each
bootstrap sample. If specified, this overrides the
<code>control.ratio</code> parameter.</li>
<li>
<code>control.replace</code> (default is <code>TRUE</code>) -
Specify whether random sampling of control units does so with
replacement.</li>
<li>
<code>treated.sample.size</code> (default is the number of treatment
units) - The number of treatment units to sample for each bootstrap
sample.</li>
<li>
<code>treated.replace</code> (default is <code>TRUE</code>) -
Specify whether random sampling of treatment units does so with
replacement.</li>
<li>
<code>methods</code> - A list of functions to perform a propensity
score analysis for each bootstrap sample. See the methods section
below.</li>
<li>
<code>parallel</code> (default is <code>TRUE</code>) - Whether the
bootstrapping procedure should be run in parallel.</li>
<li>
<code>seed</code> - Seed used for the random number generator. If
specified, the random seed will be set to <code>seed + i</code> where
<code>i</code> is the current bootstrap sample in (1, M).</li>
</ul>
<p>Other parameters can be passed to <code>methods</code> using the
<code>...</code> parameter.</p>
<div class="section level3">
<h3 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h3>
<p>The <code>methods</code> parameter on the <code>PSAboot</code>
function specifies the different propensity score methods that will be
used. Specifically, for each bootstrap sample drawn, each function will
be called. This allows for a comparison of methods across all bootstrap
samples. Five methods are included, they are:</p>
<ul>
<li>
<code>boot.strata</code> - This method estimates propensity scores
using logistic regression and stratifies using quintiles on the
propensity scores. Effects within each strata are estimated and
aggregated.</li>
<li>
<code>boot.ctree</code> - This method creates strata using
conditional inference trees vis-a-vis the <code>ctree</code> function in
the <code>party</code> package. Effects within each strata (i.e. leaf
node) are estimated and aggregated.</li>
<li>
<code>boot.rpart</code> - This method creates strata using
classification trees vis-a-vis the <code>rpart</code> function. Effects
within each strata (i.e. leaf node) are estimated and aggregated.</li>
<li>
<code>boot.matching</code> - This method finds matched pairs using
the <code>Match</code> function in the <code>Matching</code> package. A
paired dependent sample t-test is used to estimate effect sizes.</li>
<li>
<code>boot.matchit</code> - This method finds match pairs using the
<code>matchit</code> function in the <code>MatchIt</code> package. A
paired dependent sample t-ttest is used to estimate effect sizes.</li>
</ul>
<div class="section level4">
<h4 id="defining-custom-methods">Defining Custom Methods<a class="anchor" aria-label="anchor" href="#defining-custom-methods"></a>
</h4>
<p>It is possible to define a custom method. Each method is a function
with, at minimum, the following six parameters:</p>
<ul>
<li>
<code>Tr</code> - A logical or integer (0 and 1) vector with
treatment indicators.</li>
<li>
<code>Y</code> - A numeric vector representing the outcome.</li>
<li>
<code>X</code> - A data frame with the covariates.</li>
<li>
<code>X.trans</code> - A data frame with factor levels dummy
coded.</li>
<li>
<code>formu</code> - A formula for estimating propensity scores in
phase one.</li>
<li>
<code>...</code> - Other parameters passed through from the
<code>PSAboot</code> function.</li>
</ul>
<p>Each method must return a <code>list</code> with three elements:</p>
<ul>
<li>
<code>summary</code> - This must be a named numeric vector with at
minimum <code>estimate</code>, <code>ci.min</code>, and
<code>ci.max</code>, however other values allowed.</li>
<li>
<code>balance</code> - This must be a named numeric vector with one
element per covariate listed in <code>X.trans</code> representing a
balance statistic. It is recommended, and the implementation for the
built-in methods, to use an absolute standardized effect size. As will
be shown below, the summary and plotting functions will include an
adjusted balance statistic (i.e. effect size) before adjustment for
comparison.</li>
<li>
<code>details</code> - This can be an arbitrary object, typically
the result of the underlying method used.</li>
</ul>
<p>For example, the <code>boot.matching.1to3</code> function below wraps
the built-in <code>boot.matching</code> method but sets the
<code>M</code> parameter to 3, thereby performing 1-to-3 matching
instead of the default 1-to-1 matching. This framework simplifies the
process of using, and comparing, slight variations of different
propensity score methods.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot.matching.1to3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Tr</span>, <span class="va">Y</span>, <span class="va">X</span>, <span class="va">X.trans</span>, <span class="va">formu</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/boot.matching.html">boot.matching</a></span><span class="op">(</span>Tr<span class="op">=</span><span class="va">Tr</span>, Y<span class="op">=</span><span class="va">Y</span>, X<span class="op">=</span><span class="va">X</span>, X.trans<span class="op">=</span><span class="va">X.trans</span>, formu<span class="op">=</span><span class="va">formu</span>, M<span class="op">=</span><span class="fl">3</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <code>PSAboot</code> function returns an object of class
<code>PSAboot</code>. The following S3 methods are implemented:
<code>print</code>, <code>summary</code>, <code>plot</code>,
<code>boxplot</code>, and <code>matrixplot</code>.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-one-national-work-demonstration-and-psid">Example One: National Work Demonstration and PSID<a class="anchor" aria-label="anchor" href="#example-one-national-work-demonstration-and-psid"></a>
</h2>
<p>The <code>lalonde</code> (Lalonde, 1986) has become the <em>de
defacto</em> teaching dataset in PSA since Dehejia and Wahba’s (1999)
re-examination of the National Supported Work Demonstration (NSW) and
the Current Population Survey (CPS).</p>
<p>The <code>lalonde</code> data set is included in the
<code>Matching</code> package. The contingency table shows that there
are 429 control units and 185 treatment units.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lalonde</span>, package<span class="op">=</span><span class="st">'Matching'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##   0   1 </span></span>
<span><span class="co">## 260 185</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lalonde.formu</span> <span class="op">&lt;-</span> <span class="va">treat</span><span class="op">~</span><span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">educ</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span></span>
<span>             <span class="va">hisp</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegr</span> <span class="op">+</span> <span class="va">re74</span>  <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">re74</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">re75</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">re75</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>             <span class="va">u74</span> <span class="op">+</span> <span class="va">u75</span></span>
<span><span class="va">boot.lalonde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSAboot.html">PSAboot</a></span><span class="op">(</span>Tr <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>, </span>
<span>                        Y <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">re78</span>,</span>
<span>                        X <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                        formu <span class="op">=</span> <span class="va">lalonde.formu</span>,</span>
<span>                        M <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                        seed <span class="op">=</span> <span class="fl">2112</span><span class="op">)</span></span></code></pre></div>
<p>The <code>summary</code> function provides numeric results for each
method including the overall estimate and confidence interval using the
complete sample as well as the pooled estimates and confidence intervals
with percentages of the number of confidence intervals that do not span
zero.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">boot.lalonde</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Stratification Results:</span></span>
<span><span class="co">##    Complete estimate = 1493</span></span>
<span><span class="co">##    Complete CI = [231, 2755]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 1426</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 1376</span></span>
<span><span class="co">##    Bootstrap pooled CI = [89.1, 2762]</span></span>
<span><span class="co">##    59% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       59% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## ctree Results:</span></span>
<span><span class="co">##    Complete estimate = 1598</span></span>
<span><span class="co">##    Complete CI = [-6.62, 3203]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 1457</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 1463</span></span>
<span><span class="co">##    Bootstrap pooled CI = [170, 2743]</span></span>
<span><span class="co">##    39% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       39% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## rpart Results:</span></span>
<span><span class="co">##    Complete estimate = 1332</span></span>
<span><span class="co">##    Complete CI = [-295, 2959]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 1429</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 1442</span></span>
<span><span class="co">##    Bootstrap pooled CI = [-136, 2993]</span></span>
<span><span class="co">##    32% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       32% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## Matching Results:</span></span>
<span><span class="co">##    Complete estimate = 1069</span></span>
<span><span class="co">##    Complete CI = [396, 1742]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 1370</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 1364</span></span>
<span><span class="co">##    Bootstrap pooled CI = [-322, 3062]</span></span>
<span><span class="co">##    83% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       83% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## MatchIt Results:</span></span>
<span><span class="co">##    Complete estimate = 2053</span></span>
<span><span class="co">##    Complete CI = [657, 3450]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 1755</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 1745</span></span>
<span><span class="co">##    Bootstrap pooled CI = [356, 3154]</span></span>
<span><span class="co">##    74% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       74% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## Weighting Results:</span></span>
<span><span class="co">##    Complete estimate = 1558</span></span>
<span><span class="co">##    Complete CI = [310, 2807]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 1489</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 1440</span></span>
<span><span class="co">##    Bootstrap pooled CI = [126, 2853]</span></span>
<span><span class="co">##    64% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       64% positive.</span></span>
<span><span class="co">##       0% negative.</span></span></code></pre>
<p>The <code>plot</code> function plots the estimate (mean difference)
for each bootstrap sample. The default is to sort from largest to
smallest estimate for each method separately. That is, rows do not
correspond across methods. The <code>sort</code> parameter can be set to
<code>none</code> for no sorting or the name of any <code>method</code>
to sort only based upon the results of that method. In these cases the
rows then correspond to matching bootstrap samples. The blue points
correspond to the the estimate for each bootstrap sample and the
horizontal line to the confidence interval. Confidence intervals that do
not span zero are colored red. The vertical blue line and green lines
correspond to the overall pooled estimate and confidence for each
method, respectively.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">boot.lalonde</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/lalonde.plot-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The <code>hist</code> function plots a histogram of the estimates
across all bootstrap samples for each method.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">boot.lalonde</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/lalonde.histogram-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The <code>boxplot</code> function depicts the distribution of
estimates for each method along with confidence intervals in green.
Additionally, the overall pooled estimate and confidence interval across
all bootstrap samples and methods are represented by the vertical blue
and green lines, respectively.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">boot.lalonde</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/lalonde.boxplot-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The <code>matrixplot</code> summarizes the estimates across methods
for each bootstrap sample. The lower half of the matrix are scatter
plots where each point represents the one bootstrap sample. The red line
is a Loess regression line. The main diagonal depicts the distribution
of effects and the upper half provides the correlation of estimates. In
the following example we see that the <code>ctree</code> and
<code>Stratification</code> methods have the strongest agreement with a
correlation of 0.63 whereas the <code>rpart</code> and
<code>MatchIt</code> methods have the least agreement with a correlation
of 0.22.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/matrixplot.html">matrixplot</a></span><span class="op">(</span><span class="va">boot.lalonde</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/lalonde.matrixplot-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="evaluating-balance">Evaluating Balance<a class="anchor" aria-label="anchor" href="#evaluating-balance"></a>
</h3>
<p>The strength of propensity score analysis relies on achieving good
balance. Typically one would evaluate each covariate separately to
ensure that sufficient balance has been achieved. We recommend Helmreich
and Pruzek (2009) for a more complete discussion of visualizations to
evaluate balance. Given the large number of samples and methods used, it
is desirable to have a single metric to evaluate balance. Drawing on the
principles of the multiple covariate balance assessment plot (Helmreich
&amp; Pruzek, 2009), the <code>balance</code> function will estimate the
effect of each covariate before and after adjustment. Moreover, to
provide a single metric for each sample and method, the mean
standardized effect size will be used.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lalonde.bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance.html">balance</a></span><span class="op">(</span><span class="va">boot.lalonde</span><span class="op">)</span></span>
<span><span class="va">lalonde.bal</span></span></code></pre></div>
<pre><code><span><span class="co">## Unadjusted balance: 1.48309081605193</span></span>
<span><span class="co">##                   Complete  Bootstrap</span></span>
<span><span class="co">## Stratification 0.024000000 0.03798000</span></span>
<span><span class="co">## ctree          0.079000000         NA</span></span>
<span><span class="co">## rpart          0.052000000 0.07308000</span></span>
<span><span class="co">## Matching       0.026830233 0.07148576</span></span>
<span><span class="co">## MatchIt        0.054672952 0.08836800</span></span>
<span><span class="co">## Weighting      0.006256676 0.02756140</span></span></code></pre>
<p>The <code>plot</code> function provides density plots of the balance
statistics across all bootstrap samples for each method. The mean
overall balance is represented by the vertical black lines, the overall
balance for the complete dataset is represented by the vertical blue
line, and the adjusted balance is represented by the vertical red line.
Although no specific guidelines are recommended in the literature,
achieving a balance of less than 0.1 is desirable. In this example we
see that PSA has reduce the bias in all methods although
<code>rpart</code>, and to a lesser extent <code>MatchIt</code>, did not
reduce the bias by as much as would be typically desired.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lalonde.bal</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/lalonde.balance.plot-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The <code>boxplot</code> function provides a more nuanced depiction
of the balance by separating on the distribution of balance statistics
by individual covariate. In addition to the boxplot of balance
statistics, the mean balance statistic is represented by the blue point
and the unadjusted balance statistic by the red point. We see that the
largest imbalance was in the <code>black</code>, <code>married</code>,
and <code>re74</code> (real earnings in 1974) before adjustment. All of
the estimates reduced the bias in these covariates although it is worth
noting that the <code>MatchIt</code> method did not reduce the bias in
the <code>black</code> covariate to a desirable level.</p>
<p>This figure, in conjunction with the density plot above, show that
the relatively large mean balance for <code>rpart</code> is likely due
to some outlier samples where the adjusted balance for
<code>educ</code>, <code>re75</code>, and <code>hispan</code> are fairly
large. It should be noted that with these exceptions, balance for each
covariates are generally less than the unadjusted balance.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">lalonde.bal</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/lalonde.balance.boxplot-1.png" width="100%" style="display: block; margin: auto;"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="example-two-effectiveness-of-tutoring-on-course-grades">Example Two: Effectiveness of Tutoring on Course Grades<a class="anchor" aria-label="anchor" href="#example-two-effectiveness-of-tutoring-on-course-grades"></a>
</h2>
<p>This example utilizes a dataset in the <code>TriMatch</code> package
that provides student data in online English courses. The original study
examined the effects of tutoring on English course grades. In the
original study two treatments were defined, those who used tutoring
services once and those who used tutoring services two or more times
during the course term. The outcome of interest was course grade (0=F,
1=D, 2=C, 3=B, 4=A). For our purposes here we will consider only one
treatment group: students who used tutoring services at least once
during the course.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://jason.bryer.org/TriMatch" class="external-link">TriMatch</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jbryer/PSAboot" class="external-link">PSAboot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tutoring</span>, package<span class="op">=</span><span class="st">'TriMatch'</span><span class="op">)</span></span>
<span><span class="va">tutoring</span><span class="op">$</span><span class="va">treatbool</span> <span class="op">&lt;-</span> <span class="va">tutoring</span><span class="op">$</span><span class="va">treat</span> <span class="op">!=</span> <span class="st">'Control'</span></span>
<span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="va">tutoring</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Gender'</span>, <span class="st">'Ethnicity'</span>, <span class="st">'Military'</span>, <span class="st">'ESL'</span>, <span class="st">'EdMother'</span>, <span class="st">'EdFather'</span>,</span>
<span>                    <span class="st">'Age'</span>, <span class="st">'Employment'</span>, <span class="st">'Income'</span>, <span class="st">'Transfer'</span>, <span class="st">'GPA'</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">tutoring</span><span class="op">$</span><span class="va">treatbool</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## FALSE  TRUE </span></span>
<span><span class="co">##   918   224</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutoring.boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSAboot.html">PSAboot</a></span><span class="op">(</span>Tr<span class="op">=</span><span class="va">tutoring</span><span class="op">$</span><span class="va">treatbool</span>, </span>
<span>                         Y<span class="op">=</span><span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span>, </span>
<span>                         X<span class="op">=</span><span class="va">covs</span>, </span>
<span>                         seed<span class="op">=</span><span class="fl">2112</span>,</span>
<span>                         M<span class="op">=</span><span class="va">boot.M</span>,</span>
<span>                         control.sample.size<span class="op">=</span><span class="fl">918</span>, control.replace<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                         treated.sample.size<span class="op">=</span><span class="fl">224</span>, treated.replace<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                         methods<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Stratification'</span><span class="op">=</span><span class="va">boot.strata</span>,</span>
<span>                                  <span class="st">'ctree'</span><span class="op">=</span><span class="va">boot.ctree</span>,</span>
<span>                                  <span class="st">'rpart'</span><span class="op">=</span><span class="va">boot.rpart</span>,</span>
<span>                                  <span class="st">'Matching'</span><span class="op">=</span><span class="va">boot.matching</span>,</span>
<span>                                  <span class="st">'Matching-1-to-3'</span><span class="op">=</span><span class="va">boot.matching.1to3</span>,</span>
<span>                                  <span class="st">'MatchIt'</span><span class="op">=</span><span class="va">boot.matchit</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Stratification Results:</span></span>
<span><span class="co">##    Complete estimate = 0.482</span></span>
<span><span class="co">##    Complete CI = [0.3, 0.665]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 0.433</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 0.43</span></span>
<span><span class="co">##    Bootstrap pooled CI = [0.331, 0.535]</span></span>
<span><span class="co">##    100% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       100% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## ctree Results:</span></span>
<span><span class="co">##    Complete estimate = 0.458</span></span>
<span><span class="co">##    Complete CI = [0.177, 0.739]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 0.422</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 0.423</span></span>
<span><span class="co">##    Bootstrap pooled CI = [0.262, 0.582]</span></span>
<span><span class="co">##    90% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       90% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## rpart Results:</span></span>
<span><span class="co">##    Complete estimate = 0.475</span></span>
<span><span class="co">##    Complete CI = [0.165, 0.784]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 0.384</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 0.381</span></span>
<span><span class="co">##    Bootstrap pooled CI = [0.183, 0.584]</span></span>
<span><span class="co">##    80% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       80% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## Matching Results:</span></span>
<span><span class="co">##    Complete estimate = 0.479</span></span>
<span><span class="co">##    Complete CI = [0.388, 0.571]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 0.462</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 0.46</span></span>
<span><span class="co">##    Bootstrap pooled CI = [0.319, 0.605]</span></span>
<span><span class="co">##    100% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       100% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## Matching-1-to-3 Results:</span></span>
<span><span class="co">##    Complete estimate = 0.472</span></span>
<span><span class="co">##    Complete CI = [0.411, 0.533]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 0.475</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 0.465</span></span>
<span><span class="co">##    Bootstrap pooled CI = [0.293, 0.657]</span></span>
<span><span class="co">##    100% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       100% positive.</span></span>
<span><span class="co">##       0% negative.</span></span>
<span><span class="co">## MatchIt Results:</span></span>
<span><span class="co">##    Complete estimate = 0.513</span></span>
<span><span class="co">##    Complete CI = [0.264, 0.762]</span></span>
<span><span class="co">##    Bootstrap pooled estimate = 0.532</span></span>
<span><span class="co">##    Bootstrap weighted pooled estimate = 0.529</span></span>
<span><span class="co">##    Bootstrap pooled CI = [0.282, 0.782]</span></span>
<span><span class="co">##    100% of bootstrap samples have confidence intervals that do not span zero.</span></span>
<span><span class="co">##       100% positive.</span></span>
<span><span class="co">##       0% negative.</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/tutoring.plot-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/tutoring.histogram-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/tutoring.boxplot-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/matrixplot.html">matrixplot</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/tutoring.matrixplot-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutoring.bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance.html">balance</a></span><span class="op">(</span><span class="va">tutoring.boot</span><span class="op">)</span></span>
<span><span class="va">tutoring.bal</span></span></code></pre></div>
<pre><code><span><span class="co">## Unadjusted balance: 1.83221548386189</span></span>
<span><span class="co">##                   Complete  Bootstrap</span></span>
<span><span class="co">## Stratification  0.02923077 0.03361538</span></span>
<span><span class="co">## ctree           0.04384615 0.07207692</span></span>
<span><span class="co">## rpart           0.07846154 0.08769231</span></span>
<span><span class="co">## Matching        0.04521604 0.05690085</span></span>
<span><span class="co">## Matching-1-to-3 0.03054791 0.05275685</span></span>
<span><span class="co">## MatchIt         0.05078077 0.06666851</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tutoring.bal</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/tutroing.balance-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">tutoring.bal</span><span class="op">)</span></span></code></pre></div>
<p><img src="PSAboot_files/figure-html/tutroing.balance-2.png" width="100%" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bryer, J.M. (2013). TriMatch: Propensity Score Matching of Non-Binary
Treatments. R package version 0.9.1. <a href="https://github.com/jbryer/TriMatch" class="external-link uri">https://github.com/jbryer/TriMatch</a></p>
<p>Helmreich, J.E., Pruzek, R.M. (2009). PSAgraphics: An R Package to
Support Propensity Score Analysis. Journal of Statistical Software
29(6), 1-23. <a href="https://www.jstatsoft.org/v29/i06/" class="external-link uri">https://www.jstatsoft.org/v29/i06/</a>.</p>
<p>Ho, D.E., Imai, K., King, G., &amp; Stuart, E.A. (2011). MatchIt:
Nonparametric Preprocessing for Parametric Causal Inference. Journal of
Statistical Software, (42) 8, 1-28. URL <a href="https://www.jstatsoft.org/v42/i08/" class="external-link uri">https://www.jstatsoft.org/v42/i08/</a></p>
<p>Hothorn, T., Hornik, K., &amp; Zeileis, A. (2006). Unbiased Recursive
Partitioning: A Conditional Inference Framework. Journal of
Computational and Graphical Statistics, 15(3), 651-674.</p>
<p>Lalonde, R. (1986). Evaluating the econometric evaluations of
training programs with experimental data. American Economic Review 76:
604-620.</p>
<p>Dehejia, R.H. and Wahba, S. (1999). Causal Effects in Nonexperimental
Studies: Re-Evaluating the Evaluation of Training Programs. Journal of
the American Statistical Association 94: 1053-1062.</p>
<p>R Core Team (2013). R: A language and environment for statistical
computing. R Foundation for Statistical Computing, Vienna, Austria. URL
<a href="https://www.r-project.org/" class="external-link uri">https://www.r-project.org/</a>.</p>
<p>Rosenbaum, P.R. (2012). Testing one hypothesis twice in observational
studies. Biometrika, 99, 4, 763-774.</p>
<p>Rosenbaum, P.R., &amp; Rubin, D.B. (1983). The central role of the
propensity score in observational studies for causal effects.
Biometrika, 70, 1, 41-55.</p>
<p>Sekhon, J.S. (2011). Multivariate and Propensity Score Matching
Software with Automated Balance Optimization: The Matching Package for
R. Journal of Statistical Software, 42(7), 1-52. URL <a href="https://www.jstatsoft.org/v42/i07/" class="external-link uri">https://www.jstatsoft.org/v42/i07/</a>.</p>
<p>Therneau, T., Atkinson, B., &amp; Ripley, B. (2013). rpart: Recursive
Partitioning. R package version 4.1-3. <a href="https://cran.r-project.org/package=rpart" class="external-link uri">https://cran.r-project.org/package=rpart</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jason Bryer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
